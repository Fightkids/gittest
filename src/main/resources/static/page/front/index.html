<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/base.css">

    <style>

    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <!-- header-->
    <el-row>
        <div style="height: 60px; line-height: 60px; background: white">
            <el-row>
                <el-col :span="9">
                    <div style="color: black; font-size: 24px; padding-left: 100px">心理健康网</div>
                </el-col>
                <el-col :span="12">
                    <el-menu default-active="index" mode="horizontal" @select="handleSelect">
                        <el-menu-item index="index">首页</el-menu-item>
                        <el-menu-item index="test">心理测试</el-menu-item>
                        <el-menu-item index="im">心理辅导</el-menu-item>

                    </el-menu>
                </el-col>
                <el-col :span="3">
                    <div v-if="user.id">
                        <span>hello, tom</span>
                        <el-button size="mini" @click="logout">退出</el-button>
                    </div>
                    <div v-else>
                        <a href="/page/end/login.html"><el-button size="mini" type="primary">登录</el-button></a>
                        <a href="/page/end/register.html"><el-button size="mini">注册</el-button></a>
                    </div>
                </el-col>
            </el-row>
        </div>
    </el-row>

    <!-- main -->
    <el-row>
        <el-col :span="14" :offset="5">

            <div style="margin: 10px 0">
                <el-carousel height="400px">
                    <el-carousel-item v-for="item in imgList" :key="item">
                        <img style="width: 100%" :src='item' alt="">
                    </el-carousel-item>
                </el-carousel>
            </div>


            <div style="margin-bottom: 50px">
                <el-card>
                    <div style="border-bottom: 1px solid orangered; padding: 10px 0; font-size: 20px">最新文章</div>
                    <div style="padding: 15px; border-bottom: 1px dashed #ccc; color: #888" v-for="item in tableData">
                        <el-row>
                            <el-col :span="12">
                                <a :href=`article.html?id=${item.id}`>{{ item.name }}</a>
                            </el-col>
                            <el-col :span="12" style="text-align: right; font-size: 14px">
                                <span style="">{{ item.user }}</span>
                                <span style="margin-left: 50px">{{ item.time }}</span>
                            </el-col>
                        </el-row>


                    </div>

                    <!-- 分页 -->
                    <div style="background-color: white; margin-top: 10px">
                        <el-pagination
                                @size-change="handleSizeChange"
                                @current-change="handleCurrentChange"
                                :current-page="pageNum"
                                :page-sizes="[5, 10, 20, 40]"
                                :page-size="pageSize"
                                layout=" prev, pager, next"
                                :total="total">
                        </el-pagination>
                    </div>
                </el-card>
            </div>
        </el-col>
    </el-row>

    <div style=" height: 50px; line-height: 30px; text-align: center">
        <el-card>
            京ICP备14042574号-1 ©2021 在线测评辅导系统
            <p>
                联系电话: 010-87675654
                <span style="margin-left: 50px">地址：北京市朝阳区十里堡</span>
            </p>

        </el-card>

    </div>

</div>

<!--    js-->
<script src="../../js/jquery.min.js"></script>

<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>

<script>
    new Vue({
        el: "#wrapper",
        data: {
            search: '',
            tableData: [],
            pageNum: 1,
            pageSize: 10,
            total: 0,
            user: {},
            imgList: [
                'https://img.zcool.cn/community/01e1605ef84d6ca80120662165f99a.png@1280w_1l_2o_100sh.png',
                'https://img.zcool.cn/community/014f335ef84d6ba801215aa0e5572e.png@1280w_1l_2o_100sh.png',
                'https://img.zcool.cn/community/014c235ef84d6ca801215aa030eb99.png@1280w_1l_2o_100sh.png'
            ]
        },
        created() {
            this.user = sessionStorage.getItem("user") ? JSON.parse(sessionStorage.getItem("user")) : {};

            this.loadTable()
        },
        methods: {
            handleSelect(key) {
                location.href = key + '.html'
            },
            logout() {
                $.get("/api/user/logout");
                sessionStorage.removeItem("user");
                location.href = "/page/end/login.html";
            },
            loadTable() {
                $.get("/api/article/page?pageNum=" + this.pageNum + "&pageSize=" + this.pageSize + "&name=" + this.search).then(res => {
                    this.tableData = res.data.records;
                    this.total = res.data.total;
                })
            },
            handleSizeChange(pageSize) {
                this.pageSize = pageSize;
                this.loadTable();
            },
            handleCurrentChange(pageNum) {
                this.pageNum = pageNum;
                this.loadTable();
            },
        }
    })
</script>
</body>
</html>
