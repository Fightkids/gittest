<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>剧团</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/base.css">

    <style>

    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <!-- header-->
    <el-row>
        <div style="height: 60px; line-height: 60px; background: white">
            <el-row>
                <el-col :span="9">
                    <div style="color: black; font-size: 24px; padding-left: 100px">玩儿剧团</div>
                </el-col>
                <el-col :span="12">
                    <el-menu default-active="index" mode="horizontal" @select="handleSelect">
                        <el-menu-item index="index">首页</el-menu-item>
                        <el-menu-item index="message">在线留言</el-menu-item>
                        <el-menu-item index="person">个人信息</el-menu-item>

                    </el-menu>
                </el-col>
                <el-col :span="3">
                    <div v-if="user.id">
                        <span>hello, tom</span>
                        <el-button size="mini" @click="logout">退出</el-button>
                    </div>
                    <div v-else>
                        <a href="/page/end/login.html">
                            <el-button size="mini" type="primary">登录</el-button>
                        </a>
                        <a href="/page/end/register.html">
                            <el-button size="mini">注册</el-button>
                        </a>
                    </div>
                </el-col>
            </el-row>
        </div>
    </el-row>

    <!-- main -->
    <div id="main" style="margin-bottom: 50px">
        <iframe id="myiframe" :src="src + '?new=' + Math.random()" frameborder="0" scrolling="no"
                style="width: 100%"></iframe>
    </div>

    <!-- main -->


    <div style="text-align: center; position: fixed; bottom: 0; width: 100%">
        <el-card>
            京ICP备14042574号-1 ©2021 剧团系统
            <p>
                联系电话: 010-87675654
                <span style="margin-left: 50px">地址：北京市朝阳区十里堡</span>
            </p>

        </el-card>

    </div>

</div>

<!--    js-->
<script src="../../js/jquery.min.js"></script>

<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>

<script>
    // 实现 iframe  高度自适应
    function reinitIframe() {
        const iframe = document.getElementById("myiframe");
        try {
            const bHeight = iframe.contentWindow.document.body.scrollHeight;
            const dHeight = iframe.contentWindow.document.documentElement.scrollHeight;
            const height = Math.max(bHeight, dHeight);
            iframe.height = height;
            console.log(height);
        } catch (ex) {
        }
    }

    window.setInterval("reinitIframe()", 100);


    new Vue({
        el: "#wrapper",
        data: {
            user: {},
            src: 'index.html',
        },
        created() {
            $.ajax({url: '/api/user/session', method: "GET", async: false, success: (res) => {this.user = res.data || {}}})
        },
        methods: {
            handleSelect(key) {
                this.src = key + '.html'
            },
            logout() {
                $.get("/api/user/logout");
                sessionStorage.removeItem("user");
                location.href = "/page/end/login.html";
            },
        }
    })
</script>
</body>
</html>
