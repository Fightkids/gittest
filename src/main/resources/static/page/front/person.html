<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的信息</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/base.css">

    <style>
        body {
            background-color: #FCF9EA !important;
        }
    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <el-row style="margin-bottom: 50px">
        <el-col :span="10" :offset="7">

            <div style="margin: 10px 0">
                <el-card>
                    <el-form :model="user" style="width: 80%; margin: 0 auto">
                        <el-form-item label="用户名" label-width="100px">
                            <el-input v-model="user.username" autocomplete="off" style="width: 80%"></el-input>
                        </el-form-item>
                        <el-form-item label="邮箱" label-width="100px">
                            <el-input v-model="user.email" autocomplete="off" style="width: 80%"></el-input>
                        </el-form-item>
                        <el-form-item label="电话" label-width="100px">
                            <el-input v-model="user.phone" autocomplete="off" style="width: 80%"></el-input>
                        </el-form-item>
                        <el-form-item label="密码" label-width="100px">
                            <el-input show-password v-model="user.password" autocomplete="off" style="width: 80%"></el-input>
                        </el-form-item>
                    </el-form>

                    <div style="padding: 10px 0; text-align: center">
                        <el-button type="primary" @click="save">保 存</el-button>
                    </div>
                </el-card>


            </div>

        </el-col>
    </el-row>



</div>

<!--    js-->
<script src="../../js/jquery.min.js"></script>

<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>

<script>
    new Vue({
        el: "#wrapper",
        data: {
            src: 'message.html',
            search: '',
            entity: {},
            tableData: [],
            pageNum: 1,
            pageSize: 10,
            total: 0,
            user: {},
            imgList: [
                'https://img.zcool.cn/community/01e1605ef84d6ca80120662165f99a.png@1280w_1l_2o_100sh.png',
                'https://img.zcool.cn/community/014f335ef84d6ba801215aa0e5572e.png@1280w_1l_2o_100sh.png',
                'https://img.zcool.cn/community/014c235ef84d6ca801215aa030eb99.png@1280w_1l_2o_100sh.png'
            ]
        },
        created() {
            $.ajax({url: '/api/user/session', method: "GET", async: false, success: (res) => {this.user = res.data || {}}})
            this.loadTable()
        },
        methods: {
            sign(obj) {
                if (!this.user.id) {
                    this.$message({
                        message: "请登录",
                        type: "warning"
                    })
                    return
                }
                this.entity = JSON.parse(JSON.stringify(obj));
                this.entity.user = this.user.username;
                this.save()
            },
            handleSelect(key) {
                location.href = key + '.html'
            },
            logout() {
                $.get("/api/user/logout");
                sessionStorage.removeItem("user");
                location.href = "/page/end/login.html";
            },
            loadTable() {
                $.get("/api/activity/page?pageNum=" + this.pageNum + "&pageSize=" + this.pageSize + "&name=" + this.search).then(res => {
                    this.tableData = res.data.records;
                    this.total = res.data.total;
                })
            },
            handleSizeChange(pageSize) {
                this.pageSize = pageSize;
                this.loadTable();
            },
            handleCurrentChange(pageNum) {
                this.pageNum = pageNum;
                this.loadTable();
            },
            save() {
                $.ajax({
                    url: "/api/user",
                    type: "PUT",
                    contentType: "application/json",
                    data: JSON.stringify(this.user)
                }).then(res => {
                    if (res.code === '0') {
                        this.$message({
                            message: "保存成功",
                            type: "success"
                        });
                        this.load();
                    } else {
                        this.$message({
                            message: res.msg,
                            type: "error"
                        })
                    }
                    this.dialogFormVisible = false;
                })
            },
        }
    })
</script>
</body>
</html>
